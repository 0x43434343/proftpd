CC=@CC@
@SET_MAKE@

top_builddir=..
top_srcdir=..
srcdir=@srcdir@
VPATH=@srcdir@

include $(top_srcdir)/Make.rules

EXEEXT=@EXEEXT@

TEST_DEPS=\
  $(top_srcdir)/src/pool.o \
  $(top_srcdir)/src/str.o \
  $(top_srcdir)/src/sets.o \
  $(top_srcdir)/src/timers.o \
  $(top_srcdir)/src/table.o \
  $(top_srcdir)/src/var.o \
  $(top_srcdir)/src/event.o \
  $(top_srcdir)/src/env.o \
  $(top_srcdir)/src/version.o \
  $(top_srcdir)/src/feat.o \
  $(top_srcdir)/src/netaddr.o

TEST_LIBS=-lcheck

TEST_OBJS=\
  pool.o \
  array.o \
  str.o \
  sets.o \
  timers.o \
  table.o \
  var.o \
  event.o \
  env.o \
  version.o \
  feat.o \
  netaddr.o \
  stubs.o \
  tests.o


all:
	@echo "Running make from top level directory."
	cd ../; $(MAKE) all

dummy:

Makefile: Makefile.in ../config.status
	cd ../ && ./config.status

.c.o:
	$(CC) $(CPPFLAGS) $(CFLAGS) -c $<

test$(EXEEXT): $(TEST_DEPS) $(TEST_OBJS)
	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o $@ $(TEST_DEPS) $(TEST_OBJS) $(LIBS) $(TEST_LIBS)

check: test$($EXEEXT) dummy
	./test$(EXEEXT)

clean:
	$(LIBTOOL) --mode=clean $(RM) *.o test$(EXEEXT)
