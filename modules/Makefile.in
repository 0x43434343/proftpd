CC=@CC@
@SET_MAKE@

top_builddir=@top_builddir@
top_srcdir=@top_srcdir@
srcdir=@srcdir@

LIBEXECDIR=@LIBEXECDIR@
LIBTOOL=@LIBTOOL@
SHARED_CFLAGS=-DPR_SHARED_MODULE
SHARED_LDFLAGS=-avoid-version -export-dynamic -module
VPATH=@srcdir@

INSTALL=@INSTALL@
INSTALL_USER=@install_user@
INSTALL_GROUP=@install_group@
INSTALL_BIN=$(INSTALL) @INSTALL_STRIP@ -o $(INSTALL_USER) -g $(INSTALL_GROUP) -m 0755

include ../Make.rules

all:
	@echo "Running make from top level directory."
	cd .. && $(MAKE) all

Makefile: Makefile.in ../config.status
	cd ../ && ./config.status

.c.o:
	$(CC) $(CPPFLAGS) $(CFLAGS) -c $<

$(SHARED_MODULE_OBJS):
	$(LIBTOOL) --mode=compile $(CC) $(CPPFLAGS) $(CFLAGS) $(SHARED_CFLAGS) -c $(basename $@).c
	$(LIBTOOL) --mode=link $(CC) -o $@ -rpath $(LIBEXECDIR) $(LDFLAGS) $(SHARED_LDFLAGS) $(basename $@).lo `cat $(top_srcdir)/modules/$(basename $@).c | grep '$$Libraries:' | sed -e 's/^.*\$$Libraries: \(.*\)\\$$/\1/'`

module_glue.c: module_glue.c.tmpl $(STATIC_MODULE_OBJS)
	srcdir=$(srcdir) $(srcdir)/glue.sh $(STATIC_MODULE_OBJS)

shared-modules: $(SHARED_MODULE_OBJS)

static-modules: $(STATIC_MODULE_OBJS) module_glue.o

install:
	$(LIBTOOL) --mode=install $(INSTALL_BIN) $(SHARED_MODULE_OBJS) $(LIBEXECDIR)

clean:
	rm -f *.o module_glue.c
	$(LIBTOOL) --mode=clean $(RM) $(SHARED_MODULE_OBJS)
	$(LIBTOOL) --mode=clean $(RM) `echo $(SHARED_MODULE_OBJS) | sed 's/\.la$\/.lo/g'`

depend:
	rm -f module_glue.c
	makedepend $(CPPFLAGS) -Y *.c 2>/dev/null
	makedepend $(CPPFLAGS) -Y -fMakefile.in *.c 2>/dev/null

# Dependancies automagically written below by makedepend

# DO NOT DELETE

mod_auth.o: ../include/conf.h ../include/version.h ../include/buildstamp.h
mod_auth.o: ../config.h ../include/default_paths.h ../include/options.h
mod_auth.o: ../include/pool.h ../include/regexp.h ../include/proftpd.h
mod_auth.o: ../include/support.h ../include/sets.h ../include/dirtree.h
mod_auth.o: ../include/netio.h ../include/modules.h ../include/timers.h
mod_auth.o: ../include/inet.h ../include/ident.h ../include/feat.h
mod_auth.o: ../include/ftp.h ../include/log.h ../include/scoreboard.h
mod_auth.o: ../include/data.h ../include/libsupp.h ../include/glibc-glob.h
mod_auth.o: ../include/fsio.h ../include/pr-syslog.h ../include/privs.h
mod_core.o: ../include/conf.h ../include/version.h ../include/buildstamp.h
mod_core.o: ../config.h ../include/default_paths.h ../include/options.h
mod_core.o: ../include/pool.h ../include/regexp.h ../include/proftpd.h
mod_core.o: ../include/support.h ../include/sets.h ../include/dirtree.h
mod_core.o: ../include/netio.h ../include/modules.h ../include/timers.h
mod_core.o: ../include/inet.h ../include/ident.h ../include/feat.h
mod_core.o: ../include/ftp.h ../include/log.h ../include/scoreboard.h
mod_core.o: ../include/data.h ../include/libsupp.h ../include/glibc-glob.h
mod_core.o: ../include/fsio.h ../include/pr-syslog.h ../include/privs.h
mod_log.o: ../include/conf.h ../include/version.h ../include/buildstamp.h
mod_log.o: ../config.h ../include/default_paths.h ../include/options.h
mod_log.o: ../include/pool.h ../include/regexp.h ../include/proftpd.h
mod_log.o: ../include/support.h ../include/sets.h ../include/dirtree.h
mod_log.o: ../include/netio.h ../include/modules.h ../include/timers.h
mod_log.o: ../include/inet.h ../include/ident.h ../include/feat.h
mod_log.o: ../include/ftp.h ../include/log.h ../include/scoreboard.h
mod_log.o: ../include/data.h ../include/libsupp.h ../include/glibc-glob.h
mod_log.o: ../include/fsio.h ../include/pr-syslog.h ../include/privs.h
mod_ls.o: ../include/conf.h ../include/version.h ../include/buildstamp.h
mod_ls.o: ../config.h ../include/default_paths.h ../include/options.h
mod_ls.o: ../include/pool.h ../include/regexp.h ../include/proftpd.h
mod_ls.o: ../include/support.h ../include/sets.h ../include/dirtree.h
mod_ls.o: ../include/netio.h ../include/modules.h ../include/timers.h
mod_ls.o: ../include/inet.h ../include/ident.h ../include/feat.h
mod_ls.o: ../include/ftp.h ../include/log.h ../include/scoreboard.h
mod_ls.o: ../include/data.h ../include/libsupp.h ../include/glibc-glob.h
mod_ls.o: ../include/fsio.h ../include/pr-syslog.h
mod_pam.o: ../include/conf.h ../include/version.h ../include/buildstamp.h
mod_pam.o: ../config.h ../include/default_paths.h ../include/options.h
mod_pam.o: ../include/pool.h ../include/regexp.h ../include/proftpd.h
mod_pam.o: ../include/support.h ../include/sets.h ../include/dirtree.h
mod_pam.o: ../include/netio.h ../include/modules.h ../include/timers.h
mod_pam.o: ../include/inet.h ../include/ident.h ../include/feat.h
mod_pam.o: ../include/ftp.h ../include/log.h ../include/scoreboard.h
mod_pam.o: ../include/data.h ../include/libsupp.h ../include/glibc-glob.h
mod_pam.o: ../include/fsio.h ../include/pr-syslog.h ../include/privs.h
mod_site.o: ../include/conf.h ../include/version.h ../include/buildstamp.h
mod_site.o: ../config.h ../include/default_paths.h ../include/options.h
mod_site.o: ../include/pool.h ../include/regexp.h ../include/proftpd.h
mod_site.o: ../include/support.h ../include/sets.h ../include/dirtree.h
mod_site.o: ../include/netio.h ../include/modules.h ../include/timers.h
mod_site.o: ../include/inet.h ../include/ident.h ../include/feat.h
mod_site.o: ../include/ftp.h ../include/log.h ../include/scoreboard.h
mod_site.o: ../include/data.h ../include/libsupp.h ../include/glibc-glob.h
mod_site.o: ../include/fsio.h ../include/pr-syslog.h
mod_unixpw.o: ../include/conf.h ../include/version.h ../include/buildstamp.h
mod_unixpw.o: ../config.h ../include/default_paths.h ../include/options.h
mod_unixpw.o: ../include/pool.h ../include/regexp.h ../include/proftpd.h
mod_unixpw.o: ../include/support.h ../include/sets.h ../include/dirtree.h
mod_unixpw.o: ../include/netio.h ../include/modules.h ../include/timers.h
mod_unixpw.o: ../include/inet.h ../include/ident.h ../include/feat.h
mod_unixpw.o: ../include/ftp.h ../include/log.h ../include/scoreboard.h
mod_unixpw.o: ../include/data.h ../include/libsupp.h ../include/glibc-glob.h
mod_unixpw.o: ../include/fsio.h ../include/pr-syslog.h ../include/privs.h
mod_xfer.o: ../include/conf.h ../include/version.h ../include/buildstamp.h
mod_xfer.o: ../config.h ../include/default_paths.h ../include/options.h
mod_xfer.o: ../include/pool.h ../include/regexp.h ../include/proftpd.h
mod_xfer.o: ../include/support.h ../include/sets.h ../include/dirtree.h
mod_xfer.o: ../include/netio.h ../include/modules.h ../include/timers.h
mod_xfer.o: ../include/inet.h ../include/ident.h ../include/feat.h
mod_xfer.o: ../include/ftp.h ../include/log.h ../include/scoreboard.h
mod_xfer.o: ../include/data.h ../include/libsupp.h ../include/glibc-glob.h
mod_xfer.o: ../include/fsio.h ../include/pr-syslog.h ../include/privs.h
