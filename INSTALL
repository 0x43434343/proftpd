                ProFTPD 1.2.0 Installation Instructions
                =======================================

------------
Introduction
------------

ProFTPD is designed to be configured for compilation on the target system by
a single shell script, named 'configure', located in the top-level directory
of the source distribution.  This script, originally generated by the GNU
autoconf tool, will analyze your system and create a 'config.h' file that
*should* allow ProFTPD to compile cleanly.  On some systems it may be necessary
to give certain options to configure or to tweak manually one or both of the
config.h and the top-level Makefile files produced by configure.

ProFTPD is designed to be very flexible, which necessarily leads to extra
compile-time and run-time configuration complexity.  The configure script
also can be used to customize your build, setting compile-time options
based on command line options that you provide.  In particular, optional
software modules to be compiled into ProFTPD may be chosen this way.

In addition to those set by the configure script, the file 'include/options.h'
contains a number of easily tweakable compile-time options which will affect
ProFTPD's operation.  These options are never modified by the configure script.
Each option is documented in the header file itself.  Changing these values
is rarely needed, and most can be overriden at run-time by directives in the
proftpd.conf configuration file.

Note that a sample RPM spec file has been included in contrib/dist/rpm/.

NOTE TO PACKAGE MAINTAINERS:
        Please, do NOT remove the ELF .comment and .note sections.



------------------
Build Requirements
------------------

        o ANSI/ISO C89/C90 C compiler, e.g. GNU gcc
        o GNU make, though most system makes should work
        o ANSI C and POSIX run-time libraries
        o BSD sockets API
        o Disk space: ~2.5 MB to unpack, 6-8 MB to build, ~2 MB to install



-------------------------
Installation Instructions
-------------------------

0.  Plan your installation.
    Please, read through all the installation steps before starting.
    There are many compile-time customizations that you may wish to make,
    particularly regarding user authentication.  Read through README.modules
    and the other README.* and contrib/README.* files.

    Note that the following modules are included by default and need not
    be added explicitly: mod_core, mod_auth, mod_xfer, mod_site, mod_ls,
    mod_unixpw, and mod_log.  Also, if libpam is detected by configure,
    the mod_pam module will be included automatically.

    You may need to specify the shared library search path on your system.
    See your system and compiler documentation.  Frequently, the -R or -rpath
    options are used for this operation.  Be very careful to set the path on
    AIX systems using the -blibpath option.  See README.AIX.

    Hint: if your configure command line becomes long or complicated,
    try storing it in a sh script file, say '.configcmd'.


1.  Configure the software.
    Run the GNU autoconf 'configure' script in the top level directory to
    create config.h and all the Makefiles.  In addition to configuring
    ProFTPD to compile on your system, you can use this step to customize
    some parameters of or add optional features to ProFTPD.  There are many
    configuration options.  To use the default values, you would simply run:

        $ ./configure

    By default the ProFTPD files will be installed as user 'root' and the
    first gid=0 group listed in /etc/group, usually either 'root' or 'wheel'.
    If you wish to install using a different user or group ownership, set the
    install_user and install_group environment variables before running
    configure.  Using a Bourne-ish style shell (e.g. sh, ksh, bash), you can
    do this on the command line like this:

        $ install_user=root install_group=wheel ./configure

    Similarly, as is typical with GNU autoconf scripts, settings for the
    compilation system can be made, such as the compiler:

        $ CC=gcc CFLAGS='-O -g' ./configure

    Other options can be given to configure as command line arguments.
    All available arguments can be listed by running './configure --help'.

    By default proftpd and ftpshut are installed in /usr/local/sbin/,
    ftpcount and ftpwho in /usr/local/bin/, the configuration file in
    /usr/local/etc/, and the man pages in /usr/local/man/man?/.  Further,
    /usr/local/var/proftpd/ is used to hold the runtime scoreboard files.
    See the "Directory and file names" section of the './configure --help'
    output for the arguments to change these defaults.  For instance,
    to place all these directories under /usr/ rather than /usr/local/,
    you could use:

        $ ./configure --prefix=/usr
    
    Or, to place the configuration file in /etc/ and the runtime state
    files in /var/proftpd/, you would use:

        $ ./configure --sysconfdir=/etc --localstatedir=/var

    Optional ProFTPD modules can be included using '--with-modules=LIST',
    where 'LIST' is a comma-separated list of module names.  This applies
    only to optional modules, such as those found in the contrib/ directory
    (the core modules in the modules/ directory are either mandatory or
    included by default, with the exception of the non-functional mod_tar
    and mod_test modules).  For example, if you wish to include both the
    readme and ldap modules, you would use:

        $ ./configure --with-modules=mod_readme:mod_ldap

    Note that if your system uses shadow password files which you wish
    to be used for user authentication, you probably need to use either
    '--enable-autoshadow' or '--enable-shadow'.  Also, if you wish to use
    the sqlpw module, you also must specify either the sqlpw or pgsql module
    later in the module list, e.g. '--with-modules=mod_sqlpw:mod_mysql'.
    It won't work if the ordering is reversed.

    Be aware that if you ever need to rerun the configure script,
    you first should run 'make distclean'.


2.  Verify correct configure operation.
    Watch the output of the configure script.  After configure has run,
    you may wish to inspect the config.h file to make sure configure didn't
    make any wrong "guesses" for your platform.


3.  Compile the software.
    Run 'make' from the top-level directory.  On some systems (e.g. BSDI),
    you may need to use GNU make (often 'gmake' or 'gnumake') instead of
    the default system make.  Watch the output of the compile process and
    make sure no errors occur.  On some platforms (notably AIX and IRIX)
    you may see some compilation or link warnings.  These generally can
    be ignored.


4.  Test the software.
    As of ProFTPD 1.2.0, there are no automated regression tests.
    However, you may wish to perform your own ad-hoc, manual tests.

    Note that you can start proftpd directly from your shell prompt, but do
    remember that it must run as root for all functions to operate properly.
    Nonetheless, many operations can be verified without root privileges.
    An alternate configuration file can be specified using the '-c' command
    line switch.  In the configuration file, the TCP ports may be changed
    from the standard default ftp (21) and ftp-data (20) ports, and an
    alternate passwd file may be specified.

        $ rm -f /tmp/TEST.passwd /tmp/PFTEST.group
        $ cp -p sample-configurations/PFTEST.[pg]* /tmp
        $ ./proftpd -c sample-configurations/PFTEST.conf

    If you encounter any problems, be sure to see the "Troubleshooting" and
    "Help" sections below.


5.  Package the software.
    As of ProFTPD 1.2.0, no packaging procedures are provided other than
    the inclusion of an RPM spec file in the contrib/dist/rpm/ directory.


6.  Install the software.
    Note: this and the remaining steps likely require root privilets.
    Unless a system specific installation package was created, e.g. an RPM,
    run 'make install' from the top-level build directory.  This installs
    the ProFTPD executables, man pages, and a basic configuration file,
    'sample-configurations/basic.conf'.  The full path to the configuration
    file will be '/usr/local/etc/proftpd.conf', unless changed in Step 1.

    If an installation package was created, install the ProFTPD package
    according to procedures appropriate for that packaging system.


7.  Modify the proftpd configuration file.
    If the User and Group specified in proftpd.conf do not exist on your
    system proftpd WILL NOT RUN.  Edit and modify proftpd.conf as needed.
    Many systems have the group "nobody" instead of the group "nogroup".
    Decide how you want to run proftpd, either started by inetd (or xinetd)
    or as a standalone daemon.  Then edit the proftpd.conf file and change
    the ServerType directive to match your choice, either "ServerType inetd"
    or "ServerType standalone".  The "basic.conf" config file, installed by
    'make install' in Step 4, has a default setting of "standalone".


8.  Modify the inetd superserver configuration file.
    Edit /etc/inetd.conf and then send the inetd process the -HUP signal,
    so that it will reread it's now modified configuration file.  On some
    systems there are other mechanisms to signal inetd to reread its
    configuration file, e.g. 'refresh -s inetd' is used on AIX.  Check your
    system documentation to see what is appropriate.

    If proftpd is to be run from inetd, find the line in /etc/inetd.conf
    that looks something like:

        ftp stream tcp nowait root      /usr/sbin/in.ftpd in.ftpd

    And replace it with:

        ftp stream tcp nowait root      /usr/local/sbin/proftpd proftpd

    Or, if the tcp wrappers package is installed on your system, you may
    use a line something like:

        ftp stream tcp nowait root      /usr/sbin/tcpd /usr/local/sbin/proftpd

    If proftpd is to be run in standalone mode, you should comment out any
    ftp line in the /etc/inetd.conf file by inserting a '#' at the beginning
    of the line.  Then signal the inetd process to reread /etc/inetd.conf.

    If your system is using xinetd instead of inetd, see README.xinetd.


9.  Modify the system boot scripts.
    If running in standalone mode, you probably will want to edit your boot
    scripts to start proftpd at boot time.  For systems that use SysV-style
    individual startup scripts, the source distribution includes an example
    init script, "contrib/dist/rpm/proftpd.init.d".


10. Create the runtime state directory.
    In order for MaxClients, MaxClientsPerHost and the ftpwho/ftpcount
    utilities to work, you need to specify a scoreboard path for proftpd's
    scoreboard files.  The default is '/usr/local/var/proftpd/', but this
    path may have been redefined in the configuration process in Step 1.
    The ScoreboardPath directive in proftpd.conf will override the default
    directory location.  Whichever directory is used, it must exist prior
    to starting proftpd, so you must create it manually if it does not
    already exist.  No special permissions are needed on the directory,
    unless you wish to restrict who is allowed to run ftpwho and ftpcount.


11. Verify operation.
    Once proftpd either has been configured to be started by inetd or has
    been started in standalone mode, try ftp'ing to your system to make
    sure that everything works.  As before, if you run into any problems,
    see the "Troubleshooting" and "Help" sections below.


12. Customize the proftpd configuration file.
    If you wish to add anonymous ftp or otherwise create a more sophisticated
    ftp configuration, read more about configuring ProFTPD:

        Configuration Examples: sample-configurations/*.conf
       Configuration Reference: doc/Configuration.html
             Configuration FAQ: doc/FAQ-config.html
                 Documentation: http://pdd.sourceforge.net/
                                http://www.proftpd.org/docs/
                           FAQ: http://pdd.sourceforge.net/faq/proftpdfaq.html

    Note that some systems will require special system-specific preparation
    of the anonymous ftp and any other chroot directories.  Also, be aware
    that the configuration directives "PersistentPasswd", "RequireValidShell",
    and "UseFtpUsers" may require special attention.

    To check the syntax of a new or modified configuration file, you may
    run 'proftpd -t -c <new_conf_file>' from the command line.

    You can test the runtime function of your configuration file without
    interfering with a running server, by running a separate test server
    on a different port.  Specify the port to use with the "Port" directive
    in the configuration file, but don't forget to restore the port setting
    before installing the new configuration file for the production server.


Good luck!



---------------
Troubleshooting
---------------

T1. Compile time problems are often easy to sort out by giving the right
    options and search paths to the compiler.  However, other times they
    can be rather distressing to debug.  Often they have to do with
    header files or C preprocessor name space conflicts.  A few packages
    have been known to install conf.h headers in /usr/local/include.
    Occasionally, one must resort to looking at the preprocessor output,
    e.g. `cc -E file.c`.

    Some common error messages are:

        o "symbol ap_signal undefined in main.o"
	  This usually means that the fnmatch.h header is including
	  the Apache ap_config.h header, though proftpd does not link
	  with the Apache library.  This mostly happens on Solaris 8,
	  though on RH6.0 <hsregex.h> causes the problem.


T2. If you encounter runtime problems, first check your syslog messages.
    The proftpd daemon logs all error conditions it encounters, including
    problems parsing the configuration file.  Authentication related
    messages are logged using the syslog facility "auth" or, if available,
    "authpriv", while all other messages use the syslog "daemon" facility,
    unless redirected by the "-n" command line switch or by the configuration
    file directives SyslogFacility or SystemLog.  Check your syslogd.conf
    to see what syslogd does with these messages.

    Some common error messages are:

        o "inet_create_connection() failed: Operation not permitted"
          This usually means that proftpd was not started as root.

        o "bind: unable to bind to port" or "Address already in use"
          This usually means that another process, either inetd, xinetd or
          another standalone ftp server, is already using the ftp port.

        o "Fatal: Socket operation on non-socket"
          This usually means that proftpd.conf ServerType directive is
          configured for inetd rather than standalone mode.

        o "received: PASS (hidden)"
          "ProFTPD terminating (signal 11)"
          This usually means that shadow passwd file support is required
          but was not compiled in.  Try starting the build over at Step 1,
          adding either '--enable-autoshadow' or '--enable-shadow'.


T3. You can generate additional debugging messages by starting the proftpd
    daemon with the "-d N" command line option, where N ranges from 1 to 5,
    with higher values increase the number of debugging messages.  If you are
    running the daemon standalone, you also may wish to use the "-n" option,
    which will keep the daemon from disassociating from your terminal and
    cause all messages to display directly on your terminal rather than
    being syslogged.


T4. If you encounter problems not readily diagnosed by the error messages,
    you might check for a newer ProFTPD release at the official distribution
    sites to see if your problem has already been fixed.  Reading the
    ChangeLog file in each new distribution is often the fastest way to
    see what bugs have been fixed.


T5. If your system has a system call trace utility, you may wish to use it
    to diagnose what is failing.  Often this method is useful to spot a
    file open failures, including shared libraries.

    Some system call trace utilities:
        o truss (Solaris, SVR4 derivatives, Unixware, AIX5L, FreeBSD)
        o trace (SunOS 4.x)
        o tusc (HP/UX 11.x: ftp://ftp.cup.hp.com/dist/networking/misc/)
          trace (HP/UX 10.x: ftp://hpux.cs.utah.edu/hpux/Sysadmin/trace-1.6/)
            http://hpux.cs.utah.edu/hppd/hpux/Sysadmin/trace-1.6/
            http://devresource.hp.com/devresource/Tools/ToolLibrary.html#perfhp
        o syscalls, trace (AIX 4.x); sctrace (AIX: [$$$] http://www.tkg.com)
        o par (Irix)
        o alpha-trace (Digital Unix: ftp://ftp.mrc-lmb.cam.ac.uk/pub/jkb/)
        o ktrace/kdump (NetBSD, OpenBSD)
        o ktrace/kdump, strace, ltrace (Linux)


T6. Another diagnostic technique is to monitor the FTP protocol communication
    between the proftpd server and the ftp client.  Many ftp clients have a
    debug or trace option.  Though requiring detailed knowledge of the FTP
    protocol, telnet can be used to connect and directly converse with the
    proftpd server.  Lastly, the FTP converstation can be observed using a
    network monitoring tool, such as tcpdump, snoop or netsnoop.


T7. Further debugging probably will require the use of a debugger,
    which may require recompiling proftpd with debugging symbols.
    Consult your compiler and debugger documentation.



----
Help
----

H1. Before asking for help on the mailing list, look through the available
    documentation, including the FAQ and the searchable archives of the
    mailing lists.  Many common questions are answered in those documents.
    See the "Resources" section below for pointers and links.


H2. When posting to the mailing list, try to be clear and concise, but give
    enough information to enable people to help.  Merely stating something
    like "It doesn't work.  Help!" is unlikely to elicit any useful answers.
    Describe your problem as completely as possible, including what you think
    is wrong, what behavior you expect, and any relevant error log messages
    or debug output.  Unless the problem occurs with the base proftpd.conf
    file or a minimal derivative, it may be useful to include part or all of
    your proftpd.conf file.

    So, at a minimum, you should include:
        o OS type and version (e.g. `uname -a`)
        o ProFTPD version (`proftpd -v`)
        o ProFTPD module list (`proftpd -l`)

    The following may help to further identify compilation information,
    especially if you are installing a vendor supplied package rather than
    building from sources yourself:
        o `what proftp` or `ident proftpd`

    And still more compilation information may be available if your system
    uses the ELF object file format:
        o `objdump -f proftp` or `dump -v -f proftp`
        o `objdump -j .comment proftp` or `dump -n .comment proftp`
        o `mcs -p proftp`
        o `objdump -j .note proftp` or `dump -v -n .note proftp`
	  or `mcs -p -n .note proftp`


H3. Please, please, do not use the bug reporting system for compilation or
    configuration problems and questions.  Those should be sent to the
    mailing list.

    In order conserve to development resources, please only submit bug reports
    when you have some reasonable confidence that there is an actual code bug,
    a portability problem, or problems with the build and compilation system.
    Even then, please first search the bug system to see if your bug has been
    reported already.  If it has, use your own best judgement about adding
    comments to the existing report, especially either to confirm the bug's
    existence or to provide additional diagnostic and debugging information.

    For some more suggestions about bug reporting, see:
        http://bugs.proftpd.org/bugwritinghelp.html



---------
Resources
---------

R1. Basics.

    Various Subjects: README.*, contrib/README.*
   Configuration Ref: doc/Configuration.html
  Config/Problem FAQ: doc/FAQ-config.html

                 WWW: http://www.proftpd.org
                 FTP: ftp://ftp.proftpd.org/distrib/
    Mirror Site List: http://pdd.sourceforge.net/mirrors.html


R2. ProFTPD Documentation Project.

              (main): http://pdd.sourceforge.net/
            (mirror): http://hamster.wibble.org/proftpd/
            (mirror): http://www.flyhmstr.demon.co.uk/proftpd/

    Config Reference: http://pdd.sourceforge.net/html/Configuration.html
                      http://pdd.sourceforge.net/directives/linked/r1.html
                      http://pdd.sourceforge.net/directives/all_directives.html
                      http://pdd.sourceforge.net/directives/all_directives.ps
                      http://pdd.sourceforge.net/directives/all_directives.pdf

                      NOTE: This Configuration.html may refer to a newer
                      code base than the one in your source distribution.

  User Guide (draft): http://pdd.sourceforge.net/userguide/linked/userguide.html
                      http://pdd.sourceforge.net/userguide/other/userguide_full.html
                      http://pdd.sourceforge.net/userguide/other/userguide.ps
                      http://pdd.sourceforge.net/userguide/other/userguide.pdf

   FAQ (hyperlinked): http://pdd.sourceforge.net/faq/proftpdfaq.html
   FAQ (single file): http://pdd.sourceforge.net/faq/proftpdfaq-full.html
                      http://pdd.sourceforge.net/faq/proftpdfaq.ps
                      http://pdd.sourceforge.net/faq/proftpdfaq.pdf
                      http://pdd.sourceforge.net/faq/proftpdfaq.txt


R3. E-Mail Lists.

       End User List
     (subscriptions): proftpd-users-request@proftpd.org
       (submissions): proftpd-users@proftpd.org
          (archives): http://www.proftpd.org/proftpd-l-archive

      Developer List
     (subscriptions): proftpd-devel-request@proftpd.org
       (submissions): proftpd-devel@proftpd.org
          (archives): http://www.proftpd.org/proftpd-devel-archive

   Announcement List
     (subscriptions): proftpd-announce-request@proftpd.org
          (archives): http://www.proftpd.org/proftpd-announce-archive

    Security Reports: security@proftpd.org


R4. Bug Tracking System (Bugzilla).

 Bug Reports/Patches: http://bugs.proftpd.org
                      proftpd-devel@proftpd.org


R5. CVS Repositories.

       Anonymous CVS: proftpd.org
      (instructions): http://www.proftpd.org/docs/cvs.html
        CVS tarballs: ftp://ftp.stikman.com/pub/proftpd/
                      ftp://ftp.linuxceptional.com/proftpd/

     Development CVS: cvs.proftpd.net


R6. Statement about proftpd.org and proftpd.net.

    The www.proftpd.org and www.proftpd.net sites now should be effectively
    mirrors of one another.  The official proftpd site is www.proftpd.org,
    however www.proftpd.net will remain in operation at a physically remote
    location in order to provide redundancy.
